#!/bin/sh

npm_xdg() { # Hacer que npm use la especificación de directorios XDG
	[ -z "$NPM_CONFIG_USERCONFIG" ] && return

	_config_dir="$(dirname "$NPM_CONFIG_USERCONFIG")"
	mkdir -p "$_config_dir"
	cat <<-'EOF' | tee "$NPM_CONFIG_USERCONFIG"
		prefix=${XDG_DATA_HOME}/npm
		cache=${XDG_CACHE_HOME}/npm
		init-module=${XDG_CONFIG_HOME}/npm/config/npm-init.js
		tmp=${XDG_RUNTIME_DIR}/npm
		logfile=${XDG_CACHE_HOME}/npm/logs/npm.log
	EOF

	mv "$HOME/.npm/_cacache" "$XDG_CACHE_HOME/npm" 2>/dev/null
	mv "$HOME/.npm/_logs" "$XDG_CACHE_HOME/npm/logs" 2>/dev/null
	rm -rf "$HOME/.npm"
}

merge_delete() {
	_og="$1"
	_xdg="$2"
	if [ -d "$_og" ]; then
		cp -r "$_og" "$_xdg"
		rm -rf "$_og"
	fi
}

moveto_xdg() {
	_og="$1"
	_xdg="$2"
	if [ -f "$_og" ]; then
		mkdir "$(dirname "$_xdg")"
		mv -f "$_og" "$_xdg"
	fi
}

move_hardcoded_dir() {
	_og="$1"
	_xdg="$2"
	if [ ! -L "$_og" ] && [ -d "$OG" ]; then
		merge_delete "$_og" "$_xdg"
		ln -s "$_xdg" "$_og"
	fi
}

# Mover archivos según la especificación XDG

[ -d "$HOME/.npm" ] && npm_xdg

merge_delete "$HOME/.pki" "$XDG_DATA_HOME/pki/"
merge_delete "$HOME/.gnupg" "$XDG_DATA_HOME/gnupg"
merge_delete "$HOME/.cargo" "$XDG_DATA_HOME/cargo"
merge_delete "$HOME/go" "$XDG_DATA_HOME/go"

moveto_xdg "$HOME/.pulse-cookie" "$XDG_CONFIG_HOME/pulse/cookie"
moveto_xdg "$HOME/.gitconfig" "$XDG_CONFIG_HOME/git/config"

move_hardcoded_dir "$HOME/.java" "$XDG_CONFIG_HOME/java"
move_hardcoded_dir "$HOME/.codetogether" "$HOME/.config/codetogether"
move_hardcoded_dir "$HOME/.webclipse" "$HOME/.config/webclipse"
move_hardcoded_dir "$HOME/wekafiles" "$XDG_DATA_HOME/weka"

# Borrar archivos
rm -f "$HOME/.wget-hsts"
rm -rf \
	"$HOME/.gtkrc-2.0" \
	"$HOME/.wine" \
	"$HOME/.xsession-errors" \
	"$HOME/.yarnrc" \
	"$HOME/Escritorio" \
	"$HOME/steam.desktop" \
	"$XDG_CONFIG_HOME/menus" \
	"$XDG_DATA_HOME/applications/wine"* \
	"$XDG_DATA_HOME/desktop-directories"

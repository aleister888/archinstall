#!/bin/bash

# Script para instalar/desinstalar Citrahold

INSTALL_DIR="$HOME/.local/opt/weka"
RUN_SCRIPT="$HOME/.local/bin/weka"
DESKTOP_FILE="$HOME/.local/share/applications/weka.desktop"

install() {
	local REPO APP_NAME VERSION DOWNLOAD_URL ZIP_LOCATION
	REPO="weka"
	APP_NAME="weka"
	VERSION="3.8.6"
	DOWNLOAD_URL="https://downloads.sourceforge.net/sourceforge/$REPO/$APP_NAME-${VERSION//./-}.zip"
	ZIP_LOCATION="/tmp/$(basename $APP_NAME).zip"
	EXTRACT_DIR="/tmp/$APP_NAME"

	mkdir -p "$HOME/.local/opt"

	# Descargamos el zipball
	curl -L "$DOWNLOAD_URL" -o "$ZIP_LOCATION" || exit
	unzip -o "$ZIP_LOCATION" -d "$EXTRACT_DIR" >/dev/null
	rm "$ZIP_LOCATION"

	mv "$EXTRACT_DIR/${APP_NAME}-${VERSION//./-}/" "$INSTALL_DIR"

	cat <<-EOF >"$RUN_SCRIPT"
		#!/bin/sh
		RUNTIME=\$(/usr/bin/archlinux-java status | grep -m1 11 | cut -d' ' -f3)

		[ -z "\$RUNTIME" ] && {
			notify-send -i weka "Error" "El paquete jdk11-openjdk debe estar instalado"
			exit 1
		}

		exec /usr/lib/jvm/\$RUNTIME/bin/java -Xms32m -Xmx2g "\$@" -jar $INSTALL_DIR/weka.jar
	EOF
	chmod +x "$RUN_SCRIPT"

	cat <<-EOF >"$DESKTOP_FILE"
		[Desktop Entry]
		Encoding=UTF-8
		Categories=Development;Science;Math;Database;Java;
		Name=Weka
		Comment=A data mining and machine learning toolkit
		Comment[de]=Werkzeuge für Datenfilterung und Lernen durch Maschine
		Comment[en]=A data mining and machine learning toolkit
		Comment[es]=Herramientas para minería de datos y aprendizaje de máquinas
		Comment[fr]=Outils pour l'extraction de connaissances a partir des données
		Comment[it]=Attrezzi per l'estrazione di dati ed imparare di macchina
		Comment[pt]=Ferramentas para a extração de dados e a aprendizagem de máquina
		Icon=weka
		Exec=$RUN_SCRIPT
		URL=https://www.cs.waikato.ac.nz/ml/weka/
		StartupNotify=false
		Terminal=false
		Type=Application
	EOF
}

uninstall() {
	true
}

help_msg() {
	echo "Uso:" >&2
	echo "  $(basename "$0") [--install/--uninstall]" >&2
	exit 1
}

# Manejo de argumentos
case "$1" in
--install) install ;;
--uninstall) uninstall ;;
--clean) clean ;;
*) help_msg ;;
esac

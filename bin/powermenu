#!/bin/bash
# shellcheck disable=SC2086
# shellcheck disable=SC2181

# Función para obtener y validar la hora
obtener_hora() {
	local HORA
	HORA=$(printf "07:00\n12:00\n17:00\n22:00" | wofi --hide-scroll --dmenu -L 4 -p 'Ingrese una hora (HH:MM):')

	if [[ $HORA =~ ^([01][0-9]|2[0-3]):[0-5][0-9]$ ]]; then
		echo "$HORA"
	else
		return 1
	fi
}

# Define las opciones con iconos
OPTIONS=(
	"<span size='x-large'></span>" # Bloquear
	"<span size='x-large'>󰒲</span>" # Suspender
	"<span size='x-large'>󱣶</span>" # Suspender hasta las...
	"<span size='x-large'></span>" # Cerrar sesión
	"<span size='x-large'></span>" # Reinciar
	"<span size='x-large'></span>" # Apagar
	"<span size='x-large'>󰤄</span>" # Hibernar
	"<span size='x-large'></span>" # BIOS
)

DMENU="wofi --dmenu --hide-scroll --columns ${#OPTIONS[@]} --hide-search --width $((${#OPTIONS[@]} * 42)) --allow-markup -L 1"

# Presenta las opciones usando dmenu
CHOSEN=$(printf '%s\n' "${OPTIONS[@]}" | $DMENU)

# Maneja la opción elegida usando un caso
case $CHOSEN in
"${OPTIONS[0]}") lock ;;
"${OPTIONS[1]}") systemctl suspend ;;
"${OPTIONS[2]}")
	HORA=$(obtener_hora)
	if [ $? -eq 0 ]; then
		sudo /usr/local/bin/wakeat "$HORA" now
	fi
	;;
"${OPTIONS[3]}") pkill Hyprland ;;
"${OPTIONS[4]}") sudo /usr/bin/systemctl reboot ;;
"${OPTIONS[5]}") sudo /usr/bin/systemctl poweroff ;;
"${OPTIONS[6]}") systemctl hibernate ;;
"${OPTIONS[7]}") systemctl reboot --firmware-setup ;;
esac

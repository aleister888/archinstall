#!/bin/bash
shopt -s extglob

# Caracteres no válidos
INVALID_CHARS_WINDOWS='[<>:"/\\|?*]'
INVALID_CHARS_ANDROID='[:?]'

find "$1" -mindepth 1 -print0 |
	while IFS= read -r -d '' ITEM; do
		NAME=${ITEM##*/}

		if [[ $NAME =~ $INVALID_CHARS_WINDOWS ]]; then
			echo "Windows: caracteres inválidos (${BASH_REMATCH[0]})"
			printf "\t%s\n" "$ITEM"
		fi

		if [[ $NAME =~ $INVALID_CHARS_ANDROID ]]; then
			echo "Android: caracteres inválidos (${BASH_REMATCH[0]})"
			printf "\t%s\n" "$ITEM"
		fi

		if [[ $NAME == @(CON|PRN|AUX|NUL) || $NAME == @(COM|LPT)?([0-9])?([0-9]) ]]; then
			echo "Windows: nombre reservado"
			printf "\t%s\n" "$ITEM"
		fi

		if [[ $NAME == *[.\ ] ]]; then
			echo "Windows: termina en espacio o punto"
			printf "\t%s\n" "$ITEM"
		fi
	done

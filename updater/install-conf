#!/bin/bash

# Script para configurar diversas partes del sistema
# - Invocado por /update.sh

[ "$(id -u)" -eq 0 ] && exit 1

DEBUG=false

# Comprobamos si el script se ejecutó en modo debug
while getopts "d" opt; do
	case $opt in
	d) DEBUG=true ;;
	*) ;;
	esac
done

# Si está en modo debug, activamos xtrace
if [ "$DEBUG" = true ]; then
	set -x
fi

########
# UDEV #
########

# Permitir a Steam controlar mandos de PlayStation 4
sudo /usr/bin/cp -f "$HOME/.dotfiles/assets/system/udev/99-steam-controller-perms.rules" \
	/usr/lib/udev/rules.d/

################
# Aplicaciones #
################

# Configurar keepassxc para que siga el tema de QT (Si no está ya configurado)
if [ ! -f "$HOME/.config/keepassxc/keepassxc.ini" ]; then
	mkdir -p "$HOME/.config/keepassxc"
	cp "$HOME/.dotfiles/assets/configs/apps/keepassxc/keepassxc.ini" \
		"$HOME"/.config/keepassxc/
fi

##############
# Miscelánea #
##############

# Desactivar el altavoz del PC
echo "blacklist pcspkr" | sudo /usr/bin/tee /etc/modprobe.d/nobeep.conf >/dev/null

# Si el dispositivo tiene una batería activar el servicio de auto-suspensión
if [ -e /sys/class/power_supply/BAT0 ]; then
	sudo /usr/bin/systemctl enable auto-suspend
# Si no la tiene, desactivarlo
else
	sudo /usr/bin/systemctl disable auto-suspend
fi
